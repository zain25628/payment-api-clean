# Payment Model

يمثّل `Payment` عملية دفع مستخرجة من رسالة SMS.

الحقول الأساسية:

- `company_id` – تشير إلى الشركة المالكة للعملية (`Company`).
- `channel_id` – القناة (Channel) التي استقبلت العملية (مثلاً e& money UAE).
- `amount` – المبلغ بوحدة كاملة (مثلاً 150 = 150 AED).
- `currency` – عملة العملية، افتراضيًا `AED`.
- `txn_id` – رقم العملية كما يصل من مزوّد الدفع (إن وجد).
- `payer_phone` – رقم هاتف الدافع (إن وجد).
- `receiver_phone` – رقم هاتف المستلم/المحفظة.
- `raw_message` – النص الخام لرسالة الـ SMS كما هي.
- `status` – حالة العملية ضمن النظام:
  - `new` – عملية جديدة لم تُستخدم بعد.
  - `pending_confirmation` – تم ربط العملية بطلب وتنتظر تأكيد الموقع.
  - `used` – عملية تم تأكيدها واستهلاكها.
  - `mismatch` – حالة خاصة عند وجود اختلاف (مثلاً في المبلغ).
- `order_id` – رقم الطلب في نظام العميل إن وُجد.
- `order_id` – رقم الطلب في نظام العميل إن وُجد.
- `confirm_token` – توكن مؤقت يُولّد عند نجاح مطابقة العملية في `/payments/check` ويُستخدم لاحقًا في `/payments/confirm` لعمل تأكيد Idempotent. يمكن أن يكون `NULL` قبل أي عملية تحقق أو بعدها إذا تمت التصفية.
- `created_at`, `updated_at`, `used_at` – طوابع زمنية للتتبع.

العلاقات:

- `company` – تربط العملية بالـ `Company` المالكة.
- `channel` – تربط العملية بالـ `Channel` التي استقبلتها (مثلاً قناة e& money معينة).

يتم تخزين كل عمليات الدفع القادمة من الـ SMS هنا لتُستخدم لاحقًا في واجهات التحقق (`/payments/check` و `/payments/confirm`).
