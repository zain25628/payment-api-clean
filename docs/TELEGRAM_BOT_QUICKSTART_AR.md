 # تشغيل بوت التلغرام (Telegram Bot Quickstart)

 ## مقدمة قصيرة

 يعمل هذا البوت كواجهة بسيطة ومفيدة فوق واجهة برمجة التطبيقات (API) الخاصة بالتطبيق. حالياً يدعم البوت الأمرين التاليين:

 - `/start`  — يعرض رسالة ترحيب للمستخدم.
 - `/ping`   — يقوم باستدعاء `GET /health` من الـ API ويعرض نتيجة الحالة للمستخدم.

 الهدف من هذا المستند هو تمكين المطورين أو المسوّقين من تجربة البوت محليًا والتأكد من أن الـ API جاهز للاستجابة.

 ## المتطلبات

 - تشغيل الـ API محليًا أو على سيرفر متاح (مثال: `http://127.0.0.1:8000`).
 - Python مثبتة مع إمكانية إنشاء `venv` (البيئة الافتراضية).
 - متغيرات البيئة التالية:
   - `TELEGRAM_BOT_TOKEN` — **إلزامي** (الرمز الذي تحصل عليه من BotFather).
   - `PAYMENT_API_BASE_URL` — اختياري، الافتراضي `http://127.0.0.1:8000`.
   - `POLL_INTERVAL_SECONDS` — اختياري، الافتراضي `2` ثانية.

 ## إعداد متغيرات البيئة

 يمكنك وضع المتغيرات في ملف `.env` في جذر المشروع كما يلي:

 ```env
 TELEGRAM_BOT_TOKEN=ضع_هنا_توكن_البوت_من_BotFather
 PAYMENT_API_BASE_URL=http://127.0.0.1:8000
 POLL_INTERVAL_SECONDS=2
 ```

 أو تعيينها مؤقتًا من نظام التشغيل (مثال سريع في PowerShell):

 ```powershell
 $env:TELEGRAM_BOT_TOKEN = 'ضع_هنا_توكن_البوت_من_BotFather'
 $env:PAYMENT_API_BASE_URL = 'http://127.0.0.1:8000'
 $env:POLL_INTERVAL_SECONDS = '2'
 ```

 ## تشغيل البوت محليًا

 1. فعّل البيئة الافتراضية (venv) الخاصة بالمشروع.
    - على Windows PowerShell (مثال):

      ```powershell
      & C:\Users\zaink\OneDrive\Desktop\api\.venv\Scripts\Activate.ps1
      ```

 2. تأكد من أن الـ API يعمل وأن نقطة النهاية `/health` تستجيب. يمكنك تجربة فتح `http://127.0.0.1:8000/health` في المتصفح أو استخدام `curl`.

 3. شغّل سكربت البوت (مثال تشغيل محدد للمشروع):

 ```powershell
 & C:\Users\zaink\OneDrive\Desktop\api\.venv\Scripts\python.exe telegram_bot.py
 ```

 ملاحظة: السكربت يستخدم آلية long polling (`getUpdates`) لجلب التحديثات من Telegram. هذا الأسلوب مناسب للتطوير والـ demo، لكنه ليس الحل الأفضل للإنتاج على نطاق واسع؛ للإنتاج استخدم Webhooks مع HTTPS وتقييدات وصول مناسبة.

 ## تجربة الأوامر من داخل تيليجرام

 - افتح المحادثة مع البوت الذي أنشأته عبر BotFather.
 - أرسل `/start` → ستتلقّى رسالة ترحيب قصيرة من البوت.
 - أرسل `/ping` → سيلتقط البوت الأمر، يستدعي `GET /health` من الـ API، ثم يعيد للمستخدم رسالة تعكس حالة الـ API مثل:

   - "API status: ok" (عند نجاح استجابة `/health`).
   - أو رسالة خطأ مناسبة إذا كان الـ API غير متاح.

 ## ملاحظات وحدود حالية

 - البوت بسيط ومخصص لبيئة التطوير والتجربة (Demo): لا يقوم بإنشاء دفعات حقيقية أو إدارة المدفوعات تلقائيًا في هذه النسخة.
 - يمكن توسيع البوت لاحقًا ليشمل أوامر إضافية مثل إنشاء دفعة جديدة، استعلام حالة دفعة، قائمة المحافظ، إلخ.
 - لا تقم بوضع توكن BotFather الإنتاجي في بيئات عامة أو على مخازن شفرة عامة دون اتخاذ إجراءات أمان (استخدام Webhooks عبر HTTPS، تقييد الوصول، تخزين آمن للمتغيرات، إلخ).
 - لتحويل هذا البوت إلى بيئة إنتاجية يجب إعادة التصميم لاستخدام Webhooks، التخزين الدائم لحالة المحادثة، وآليات إعادة المحاولة والتتبع (retry, backoff, logging, monitoring).

 ## أسئلة شائعة سريعة

 - هل البوت ينتج بيانات مالية؟
   - لا، في هذه النسخة البوت يوفّر واجهة تجريبية فقط ولا ينشئ دفعات حقيقية.

 - كيف أغيّر تردد الاستطلاع (poll interval)؟
   - عيّن المتغيّر `POLL_INTERVAL_SECONDS` في `.env` أو كمتغيّر بيئة قبل تشغيل السكربت.

 --
 وثيقة سريعة لتشغيل البوت محليًا وتجربته. للتوسيع لاحقًا، انظر إلى كود `telegram_bot.py` وأضف دعم Webhooks وتخزين الحالة عند الحاجة.
